<div class="container mt-5">
  <h2 class="mb-4 text-primary fw-bold border-bottom pb-2">Gerenciar Quest√µes</h2>

  <!-- Nav Tabs -->
  <ul class="nav nav-tabs" id="questoesTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active fw-semibold"
        id="inserir-tab"
        data-bs-toggle="tab"
        data-bs-target="#inserir"
        type="button"
        role="tab"
        aria-controls="inserir"
        aria-selected="true"
      >
        <i class="bi bi-pencil-square me-1"></i> Inserir Quest√µes
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link fw-semibold"
        id="visualizar-tab"
        data-bs-toggle="tab"
        data-bs-target="#visualizar"
        type="button"
        role="tab"
        aria-controls="visualizar"
        aria-selected="false"
      >
        <i class="bi bi-list-ul me-1"></i> Ver Quest√µes Cadastradas
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content mt-4" id="questoesTabContent">

    <!-- Inserir Quest√µes -->
    <div
      class="tab-pane fade show active"
      id="inserir"
      role="tabpanel"
      aria-labelledby="inserir-tab"
    >
      <form action="/salvar-questoes" method="POST" novalidate>
        <div class="mb-4">
         

          <div class="alert alert-info small rounded-3 shadow-sm">
            <p class="mb-2"><strong>üìå Como funciona?</strong></p>
            <p>
              Cole um <strong>bloco de texto no formato JSON</strong> contendo as informa√ß√µes das quest√µes. 
              Esse formato permite ao sistema entender cada pergunta, suas alternativas e a resposta correta.
            </p>
            <p>
              Voc√™ pode usar o ChatGPT para criar este arquivo JSON.
            </p>

            <p class="mt-3 mb-1"><strong>üí° Dica:</strong> Pe√ßa ao ChatGPT usando este prompt:</p>
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control"
                id="promptGPT"
                readonly
                value="Crie 5 quest√µes de m√∫ltipla escolha na disciplina de Hist√≥rias com 5 alternativas cada, no formato JSON com os campos: id, texto, opcoes, correta (√≠ndice), disciplina e dificuldade."
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                onclick="copiarPrompt()"
                aria-label="Copiar prompt para ChatGPT"
              >
                <i class="bi bi-clipboard"></i> Copiar Prompt
              </button>
            </div>

            <p class="mb-2"><strong>üß© Cada pergunta deve conter:</strong></p>
            <ul class="ps-4 mb-3">
              <li><code>id</code>: n√∫mero √∫nico para cada quest√£o (ex: 1, 2, 3...)</li>
              <li><code>texto</code>: o enunciado da pergunta</li>
              <li><code>opcoes</code>: lista com 5 alternativas</li>
              <li><code>correta</code>: √≠ndice da alternativa correta (0 a 4)</li>
              <li><code>disciplina</code>: mat√©ria da quest√£o (ex: Geografia, Matem√°tica)</li>
              <li><code>dificuldade</code>: n√≠vel da quest√£o ("f√°cil", "m√©dio" ou "dif√≠cil")</li>
            </ul>

            <p class="mb-2"><strong>üìã Exemplo de JSON v√°lido:</strong></p>
            <pre class="bg-light p-3 rounded border small" style="max-height: 280px; overflow:auto; font-size:0.9rem;">
[
  {
    "id": 6,
    "texto": "Qual √© o maior pa√≠s do mundo em √°rea territorial?",
    "opcoes": ["China", "Estados Unidos", "R√∫ssia", "Canad√°", "Brasil"],
    "correta": 2,
    "disciplina": "Geografia",
    "dificuldade": "m√©dio"
  },
  {
    "id": 7,
    "texto": "Quanto √© 15% de 200?",
    "opcoes": ["25", "30", "20", "35", "40"],
    "correta": 1,
    "disciplina": "Matem√°tica",
    "dificuldade": "f√°cil"
  }
]
            </pre>

            <p class="mb-0">
              Clique no bot√£o abaixo para inserir este exemplo automaticamente no campo de texto:
            </p>
            <button
              type="button"
              class="btn btn-outline-primary btn-sm mt-2"
              onclick="inserirExemploJson()"
            >
              <i class="bi bi-file-earmark-code"></i> Inserir Exemplo de Quest√µes
            </button>
          </div>

          <textarea
            id="json"
            name="json"
            class="form-control"
            rows="10"
            required
            placeholder="Cole aqui o texto com as quest√µes no formato JSON"
            style="font-family: monospace;"
          ></textarea>
        </div>

        <button type="submit" class="btn btn-success fw-semibold px-4">
          <i class="bi bi-save2 me-1"></i> Salvar Quest√µes
        </button>
      </form>
    </div>

    <!-- Ver Quest√µes -->
    <div
      class="tab-pane fade"
      id="visualizar"
      role="tabpanel"
      aria-labelledby="visualizar-tab"
    >
      <h4 class="mb-4 text-secondary fw-semibold">
        Quest√µes Existentes
      </h4>

      {{#if perguntas.length}}
      <ul class="list-group shadow-sm rounded">
        {{#each perguntas}}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div class="me-3">
            <strong>{{id}}.</strong> {{texto}} 
            <span class="badge bg-secondary ms-2 text-capitalize">{{disciplina}}</span>
            <span class="badge bg-info text-dark ms-1 text-capitalize">{{dificuldade}}</span>
          </div>
          <form action="/excluir-questao" method="POST" class="mb-0">
            <input type="hidden" name="id" value="{{id}}" />
            <button type="submit" class="btn btn-sm btn-danger" title="Excluir quest√£o">
              <i class="bi bi-trash"></i> Excluir
            </button>
          </form>
        </li>
        {{/each}}
      </ul>
      {{else}}
      <p class="text-muted fst-italic">Nenhuma quest√£o cadastrada ainda.</p>
      {{/if}}
    </div>
  </div>
</div>

<script>



  // Salvar a aba ativa no localStorage quando for clicada
  document.querySelectorAll('#questoesTab button[data-bs-toggle="tab"]').forEach(button => {
    button.addEventListener('shown.bs.tab', function (event) {
      localStorage.setItem('abaAtiva', event.target.getAttribute('data-bs-target'));
    });
  });

  // Ao carregar a p√°gina, restaurar a aba ativa do localStorage
  document.addEventListener('DOMContentLoaded', function () {
    const abaAtiva = localStorage.getItem('abaAtiva');
    if (abaAtiva) {
      const aba = new bootstrap.Tab(document.querySelector(`button[data-bs-target="${abaAtiva}"]`));
      aba.show();
    }
  });





  function inserirExemploJson() {
    const exemplo = `[
  {
    "id": 6,
    "texto": "Qual √© o maior pa√≠s do mundo em √°rea territorial?",
    "opcoes": ["China", "Estados Unidos", "R√∫ssia", "Canad√°", "Brasil"],
    "correta": 2,
    "disciplina": "Geografia",
    "dificuldade": "m√©dio"
  },
  {
    "id": 7,
    "texto": "Quanto √© 15% de 200?",
    "opcoes": ["25", "30", "20", "35", "40"],
    "correta": 1,
    "disciplina": "Matem√°tica",
    "dificuldade": "f√°cil"
  }
]`;
    document.getElementById("json").value = exemplo;
  }

  function copiarPrompt() {
    const promptInput = document.getElementById("promptGPT");
    promptInput.select();
    promptInput.setSelectionRange(0, 99999); // Para mobile
    navigator.clipboard.writeText(promptInput.value)
      .then(() => alert("Prompt copiado! Agora cole no ChatGPT."))
      .catch(() => alert("Erro ao copiar prompt, copie manualmente."));
  }
</script>
